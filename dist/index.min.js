!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.lipgloss={})}(this,function(t){"use strict";var e=function(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){return function i(r,o){try{var a=e[r](o),s=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(s).then(function(t){i("next",t)},function(t){i("throw",t)});t(s)}("next")})}},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=new(function(){function t(){n(this,t),this._overrides={}}return i(t,[{key:"assign",value:function(t){this._overrides=Object.assign(this._overrides,t)}},{key:"attribute",value:function(t){return this._overrides[t]||t}}]),t}()),o=function(t){return r.attribute(t)},a=function(t){return t.offsetHeight},s=function(){function t(e){n(this,t),this._view=e}return i(t,[{key:"exit",value:function(){var t=e(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this._view.removeAttribute(o("data-transition")),a(this._view),this._view.setAttribute(o("data-transition"),"out");case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"loading",value:function(){var t=e(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this._view.removeAttribute(o("data-transition")),a(this._view),this._view.setAttribute(o("data-transition"),"loading");case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"enter",value:function(){var t=e(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this._view.innerHTML=e.innerHTML,this._view.removeAttribute(o("data-transition")),a(this._view),this._view.setAttribute(o("data-transition"),"in");case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),u=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{bubbles:!0,cancelable:!0};t.dispatchEvent(new CustomEvent(e,n))},c=function(t){return r.attribute(t)},h=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,t),this._element=e,this._options=Object.assign(t.options,i),this.active=!!this._element.innerHTML.trim(),this._persist=this._element.hasAttribute(c("data-persist-view")),this._activeModel=this._options.model;var r=this._options.transition;if(this._transition=new r(this._element),!(this._transition instanceof s))throw new Error("Provided transition is not an instance of Transition")}return i(t,[{key:"_activate",value:function(){var t=e(regeneratorRuntime.mark(function t(e){var n,i,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.loading=!0,e.doc.then(function(){r.loading=!1}),t.t0=this.active,!t.t0){t.next=6;break}return t.next=6,this._exit(!0);case 6:return this.loading&&this._transition.loading(),t.next=9,e.querySelector(this.selector);case 9:if(n=t.sent,!(i=!!n.innerHTML.trim())){t.next=17;break}return t.next=14,this._enter(n);case 14:this._activeModel=e,t.next=18;break;case 17:this._activeModel=null;case 18:this.active=i;case 19:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_deactivate",value:function(){var t=e(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.active){t.next=2;break}return t.abrupt("return");case 2:if(!this._persist){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,this._exit();case 6:this.active=!1,this._activeModel=null;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"_enter",value:function(){var t=e(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u(this._element,"viewwillenter",this.eventOptions),t.next=3,this._transition.enter(e);case 3:u(this._element,"viewdidenter",this.eventOptions);case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_exit",value:function(){var t=e(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u(this._element,"viewwillexit",this.eventOptions),t.next=3,this._transition.exit();case 3:u(this._element,"viewdidexit",this.eventOptions);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"eventOptions",get:function(){return{bubbles:!0,cancelable:!0,detail:{name:this._name}}}},{key:"selector",get:function(){return this._options.selector||"["+c("data-view")+'="'+this._options.name+'"]'}},{key:"active",get:function(){return this._active},set:function(t){this._active=t,this._element.setAttribute(c("data-view-active"),t)}},{key:"loading",get:function(){return this._isLoading},set:function(t){var e=this;this._isLoading=t;var n,i=document.body.hasAttribute(c("data-views-loading"))?document.body.getAttribute(c("data-views-loading")).split(" "):[],r=t?(n=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(i),[this._options.name]),Array.from(new Set(n))):i.filter(function(t){return t!==e._options.name});document.body.setAttribute(c("data-views-loading"),r.join(" "))}},{key:"model",get:function(){return this._activeModel},set:function(t){var e=this;if(!this._activeModel||this._activeModel.url!==t.url){var n=t.includesView(this._options.name);Promise.resolve(n||t.querySelector(this.selector)).then(function(){return e._activate(t)},function(){return e._deactivate()})}}},{key:"name",get:function(){return this._options.name}}],[{key:"options",get:function(){return{name:null,persist:!1,transition:s,selector:null,model:null}}}]),t}(),l=function(){function t(e,i){n(this,t),this._request=new Request(e.url,i),this._hints=e.hints||[],this._doc=null}return i(t,[{key:"includesView",value:function(t){return this._hints.includes(t)}},{key:"querySelector",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body";return this.doc.then(function(e){return e.querySelector(t)}).then(function(t){return t||Promise.reject()})}},{key:"getRepresentation",value:function(){return{url:this._request.url,hints:this._hints}}},{key:"url",get:function(){return this._request.url}},{key:"doc",get:function(){return this._doc||(this._doc=fetch(this._request).then(function(t){return t.ok?t:Promise.reject()}).then(function(t){return t.text()}).then(function(t){return(new DOMParser).parseFromString(t,"text/html")})),this._doc}}]),t}(),f="pushState"in history,v=function(t){return r.attribute(t)},d=new(function(){function t(){n(this,t)}return i(t,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(f){if(this._initialized)throw new Error("You can only initialize Lipgloss once.");this._initialized=!0,this._options=Object.assign(t.options,e),this._viewsMap=new WeakMap,r.assign(this._options.attributes);var n=this._options.sanitizeUrl(window.location.href);this._model=new l({url:n,hints:this._options.defaultHints},this._options.fetch),this._addHistoryEntry(this._model,!0),this._bindEvents(),this.initializeContext(document)}}},{key:"_bindEvents",value:function(){var t=this;this._onLinkClick=this._onLinkClick.bind(this),this._onActivateViewClick=this._onActivateViewClick.bind(this),document.addEventListener("viewdidenter",function(e){return t.initializeContext(e.target)}),window.addEventListener("popstate",function(e){return t._onPopState(e)})}},{key:"initializeContext",value:function(t){var e=this;Array.from(t.querySelectorAll("["+v("data-view")+"]")).filter(function(t){return!e._viewsMap.has(t)}).forEach(function(t){return e._viewsMap.set(t,e._buildView(t,e._model))}),t.querySelectorAll("[href]["+v("data-view-link")+"]").forEach(function(t){return t.addEventListener("click",e._onLinkClick)}),t.querySelectorAll("["+v("data-activate-view")+"]").forEach(function(t){return t.addEventListener("click",e._onActivateViewClick)})}},{key:"_buildView",value:function(t,e){var n=t.getAttribute(v("data-view")),i=t.hasAttribute(v("data-persist-view")),r=this._options.transitions[n]||s;return new h(t,{name:n,transition:r,persist:i,model:e})}},{key:"_throwOnUnknownViews",value:function(t){var e=this;Array.from(t.querySelectorAll("["+v("data-view")+"]")).map(function(t){return t.getAttribute(v("data-view"))}).filter(function(t){return!e.views.some(function(e){return e.name===t})}).forEach(function(t){throw new Error((e=t,"Not able to determine where ["+v("data-view")+"='"+e+"'] should be inserted."));var e})}},{key:"_isCurrentUrl",value:function(t){return this._options.sanitizeUrl(t)===this._options.sanitizeUrl(window.location.href)}},{key:"_onLinkClick",value:function(){var t=e(regeneratorRuntime.mark(function t(e){var n,i,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),n=this._options.sanitizeUrl(e.currentTarget.href),i=e.currentTarget.getAttribute(v("data-view-link")),r=i?i.split(","):this._options.defaultHints,o=new l({url:n,hints:r},this._options.fetch),!this._isCurrentUrl(o.url)){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this._updatePage(o);case 9:this._addHistoryEntry(o);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_onActivateViewClick",value:function(){var t=e(regeneratorRuntime.mark(function t(e){var n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),n=e.currentTarget.getAttribute(v("data-activate-view")),i=this._getViewByName(n).model,!this._isCurrentUrl(i.url)){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this._updatePage(i);case 7:this._addHistoryEntry(i);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_getViewByName",value:function(t){var e=document.querySelector("["+v("data-view")+'="'+t+'"]');return this._viewsMap.get(e)}},{key:"_onPopState",value:function(t){try{var e=new l(t.state.model,this._options.fetch);this._updatePage(e)}catch(t){}}},{key:"_updatePage",value:function(){var t=e(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this._model=e,t.prev=1,this.views.forEach(function(t){return t.model=e}),t.next=5,e.doc;case 5:n=t.sent,this._throwOnUnknownViews(n),document.title=n.title,t.next=14;break;case 10:t.prev=10,t.t0=t.catch(1),console.error(t.t0),window.location.href=e.url;case 14:case"end":return t.stop()}},t,this,[[1,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:"_addHistoryEntry",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={title:document.title,url:t.url,model:t.getRepresentation()};history[e?"replaceState":"pushState"](n,document.title,t.url),u(window,"statechange",{detail:n})}},{key:"views",get:function(){var t=this;return Array.from(document.querySelectorAll("["+v("data-view")+"]")).map(function(e){return t._viewsMap.get(e)})}}],[{key:"options",get:function(){return{defaultHints:[],transitions:{},sanitizeUrl:function(t){return t},attributes:{},fetch:{credentials:"same-origin",cache:"default",redirect:"error",headers:{"X-Requested-With":"XmlHttpRequest"}}}}}]),t}());t.View=h,t.Model=l,t.Transition=s,t.Config=r,t.default=d,Object.defineProperty(t,"__esModule",{value:!0})});
